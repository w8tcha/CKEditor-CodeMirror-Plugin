(e=>{"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","diff_match_patch"],e):e(CodeMirror)})(function(p){var w=p.Pos,C="http://www.w3.org/2000/svg";function v(e,t){this.mv=e,this.type=t,this.classes="left"==t?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function h(e){e.diffOutOfDate&&(e.diff=s(e.orig.getValue(),e.edit.getValue(),e.mv.options.ignoreWhitespace),e.chunks=c(e.diff),e.diffOutOfDate=!1,p.signal(e.edit,"updateDiff",e.diff))}var g=!(v.prototype={constructor:v,init:function(e,t,i){this.edit=this.mv.edit,(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this),this.orig=p(e,I({value:t,readOnly:!this.mv.options.allowEditingOriginals},I(i))),"align"==this.mv.options.connect&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new V(this.edit)),this.orig.state.trackAlignable=new V(this.orig)),this.lockButton.title=this.edit.phrase("Toggle locked scrolling"),this.lockButton.setAttribute("aria-label",this.lockButton.title),this.orig.state.diffViews=[this];e=i.chunkClassLocation||"background";"[object Array]"!=Object.prototype.toString.call(e)&&(e=[e]),this.classes.classLocation=e,this.diff=s(r(t),r(i.value),this.mv.options.ignoreWhitespace),this.chunks=c(this.diff),this.diffOutOfDate=this.dealigned=!1,this.needsScrollSync=null,this.showDifferences=!1!==i.showDifferences},registerEvents:function(e){var t,i;this.forceUpdate=(i=>{var t,r={from:0,to:0,marked:[]},o={from:0,to:0,marked:[]},n=!1;function l(e){n=!(g=!0),"full"==e&&(i.svg&&x(i.svg),i.copyButtons&&x(i.copyButtons),u(i.edit,r.marked,i.classes),u(i.orig,o.marked,i.classes),r.from=r.to=o.from=o.to=0),h(i),i.showDifferences&&(m(i.edit,i.diff,r,DIFF_INSERT,i.classes),m(i.orig,i.diff,o,DIFF_DELETE,i.classes)),"align"==i.mv.options.connect&&F(i),k(i),null!=i.needsScrollSync&&f(i,i.needsScrollSync),g=!1}function a(e){g||(i.dealigned=!0,s(e))}function s(e){g||n||(clearTimeout(t),!0===e&&(n=!0),t=setTimeout(l,!0===e?20:250))}function e(e,t){i.diffOutOfDate||(i.diffOutOfDate=!0,r.from=r.to=o.from=o.to=0),a(t.text.length-1!=t.to.line-t.from.line)}function c(){i.diffOutOfDate=!0,i.dealigned=!0,l("full")}return i.edit.on("change",e),i.orig.on("change",e),i.edit.on("swapDoc",c),i.orig.on("swapDoc",c),"align"==i.mv.options.connect&&(p.on(i.edit.state.trackAlignable,"realign",a),p.on(i.orig.state.trackAlignable,"realign",a)),i.edit.on("viewportChange",function(){s(!1)}),i.orig.on("viewportChange",function(){s(!1)}),l(),l})(this),o(this,!0,!1),i=e,(t=this).edit.on("scroll",function(){f(t,!0)&&k(t)}),t.orig.on("scroll",function(){f(t,!1)&&k(t),i&&f(i,!0)&&k(i)})},setShowDifferences:function(e){(e=!1!==e)!=this.showDifferences&&(this.showDifferences=e,this.forceUpdate("full"))}});function f(e,t){var i,r,o,n,l,a,s,c,h;if(!e.diffOutOfDate)return e.needsScrollSync=null,!e.lockScroll||(i=+new Date,h=t?(a=e.edit,e.orig):(a=e.orig,e.edit),a.state.scrollSetBy==e&&(a.state.scrollSetAt||0)+250>i?void 0:(r=a.getScrollInfo(),"align"==e.mv.options.connect?l=r.top:(o=.5*r.clientHeight,c=r.top+o,n=a.lineAtHeight(c,"local"),n=((e,t,i)=>{for(var r,o,n,l,a=0;a<e.length;a++){var s=e[a],c=i?s.editFrom:s.origFrom,h=i?s.editTo:s.origTo;null==o&&(t<c?(o=s.editFrom,l=s.origFrom):t<h&&(o=s.editTo,l=s.origTo)),h<=t?(r=s.editTo,n=s.origTo):c<=t&&(r=s.editFrom,n=s.origFrom)}return{edit:{before:r,after:o},orig:{before:n,after:l}}})(e.chunks,n,t),a=d(a,t?n.edit:n.orig),n=d(h,t?n.orig:n.edit),c=(c-a.top)/(a.bot-a.top),(l=n.top-o+c*(n.bot-n.top))>r.top&&(s=r.top/o)<1?l=l*s+r.top*(1-s):(a=r.height-r.clientHeight-r.top)<o&&a<(c=h.getScrollInfo()).height-c.clientHeight-l&&(s=a/o)<1&&(l=l*s+(c.height-c.clientHeight-a)*(1-s))),h.scrollTo(r.left,l),h.state.scrollSetAt=i,h.state.scrollSetBy=e,1));e.lockScroll&&null==e.needsScrollSync&&(e.needsScrollSync=t)}function d(e,t){var i=t.after;return null==i&&(i=e.lastLine()+1),{top:e.heightAtLine(t.before||0,"local"),bot:e.heightAtLine(i,"local")}}function o(e,t,i){(e.lockScroll=t)&&0!=i&&f(e,DIFF_INSERT)&&k(e),(t?p.addClass:p.rmClass)(e.lockButton,"CodeMirror-merge-scrolllock-enabled")}function u(e,t,i){for(var r=0;r<t.length;++r){var o=t[r];if(o instanceof p.TextMarker)o.clear();else if(o.parent){c=s=a=l=n=void 0;for(var n=e,l=o,a=i,s=a.classLocation,c=0;c<s.length;c++)n.removeLineClass(l,s[c],a.chunk),n.removeLineClass(l,s[c],a.start),n.removeLineClass(l,s[c],a.end)}}t.length=0}function m(e,t,i,r,o){var n=e.getViewport();e.operation(function(){i.from==i.to||20<n.from-i.to||20<i.from-n.to?(u(e,i.marked,o),l(e,t,r,i.marked,n.from,n.to,o),i.from=n.from,i.to=n.to):(n.from<i.from&&(l(e,t,r,i.marked,n.from,i.from,o),i.from=n.from),n.to>i.to&&(l(e,t,r,i.marked,i.to,n.to,o),i.to=n.to))})}function y(e,t,i,r,o,n){for(var l=i.classLocation,a=e.getLineHandle(t),s=0;s<l.length;s++)r&&e.addLineClass(a,l[s],i.chunk),o&&e.addLineClass(a,l[s],i.start),n&&e.addLineClass(a,l[s],i.end);return a}function l(n,e,t,l,a,s,c){var i=w(0,0),r=w(a,0),o=n.clipPos(w(s-1)),h=t==DIFF_DELETE?c.del:c.insert;function g(e,t){for(var i=Math.max(a,e),r=Math.min(s,t),o=i;o<r;++o)l.push(y(n,o,c,!0,o==e,o==t-1));e==t&&i==t&&r==t&&(i?l.push(y(n,i-1,c,!1,!1,!0)):l.push(y(n,i,c,!1,!0,!1)))}for(var f,d=0,u=!1,m=0;m<e.length;++m){var p,v,k,b=e[m],C=b[0],b=b[1];C==DIFF_EQUAL?(v=i.line+(E(e,m)?0:1),N(i,b),v<(p=i.line+(D(e,m)?1:0))&&(u&&(g(d,v),u=!1),d=p)):(u=!0,C==t&&(v=N(i,b,!0),p=i,b=0<((C=r).line-p.line||C.ch-p.ch)?C:p,C=v,k=((k=o).line-C.line||k.ch-C.ch)<0?k:C,C=k,(f=b).line==C.line&&f.ch==C.ch||l.push(n.markText(b,k,{className:h})),i=v))}u&&g(d,i.line+1)}function k(e){if(e.showDifferences){e.svg&&(x(e.svg),t=e.gap.offsetWidth,_(e.svg,"width",t,"height",e.gap.offsetHeight)),e.copyButtons&&x(e.copyButtons);for(var t,i=e.edit.getViewport(),r=e.orig.getViewport(),o=e.mv.wrap.getBoundingClientRect().top,n=o-e.edit.getScrollerElement().getBoundingClientRect().top+e.edit.getScrollInfo().top,l=o-e.orig.getScrollerElement().getBoundingClientRect().top+e.orig.getScrollInfo().top,a=0;a<e.chunks.length;a++){var s=e.chunks[a];if(s.editFrom<=i.to&&s.editTo>=i.from&&s.origFrom<=r.to&&s.origTo>=r.from){g=c=f=h=b=k=v=p=m=u=d=void 0;var c,h,g,f,d=e,u=s,m=l,p=n,v=t,k="left"==d.type,b=d.orig.heightAtLine(u.origFrom,"local",!0)-m;d.svg&&(h=b,f=d.edit.heightAtLine(u.editFrom,"local",!0)-p,k&&(c=h,h=f,f=c),m=d.orig.heightAtLine(u.origTo,"local",!0)-m,g=d.edit.heightAtLine(u.editTo,"local",!0)-p,k&&(c=m,m=g,g=c),k=" C "+v/2+" "+f+" "+v/2+" "+h+" "+(v+2)+" "+h,c=" C "+v/2+" "+m+" "+v/2+" "+g+" -1 "+g,_(d.svg.appendChild(document.createElementNS(C,"path")),"d","M -1 "+f+k+" L "+(v+2)+" "+m+c+" z","class",d.classes.connect)),d.copyButtons&&(h=d.copyButtons.appendChild(B("div","left"==d.type?"⇝":"⇜","CodeMirror-merge-copy")),g=d.mv.options.allowEditingOriginals,h.title=d.edit.phrase(g?"Push to left":"Revert chunk"),h.chunk=u,h.style.top=(u.origTo>u.origFrom?b:d.edit.heightAtLine(u.editFrom,"local")-p)+"px",h.setAttribute("role","button"),h.setAttribute("tabindex","0"),h.setAttribute("aria-label",h.title),g)&&(f=d.edit.heightAtLine(u.editFrom,"local")-p,(k=d.copyButtons.appendChild(B("div","right"==d.type?"⇝":"⇜","CodeMirror-merge-copy-reverse"))).title="Push to right",k.chunk={editFrom:u.origFrom,editTo:u.origTo,origFrom:u.editFrom,origTo:u.editTo},k.style.top=f+"px","right"==d.type?k.style.left="2px":k.style.right="2px",k.setAttribute("role","button"),k.setAttribute("tabindex","0"),k.setAttribute("aria-label",k.title))}}}}function b(e,t){for(var i=0,r=0,o=0;o<t.length;o++){var n=t[o];if(n.editTo>e&&n.editFrom<=e)return null;if(e<n.editFrom)break;i=n.editTo,r=n.origTo}return r+(e-i)}function S(e,t,i){for(var r=e.state.trackAlignable,o=e.firstLine(),n=0,l=[],a=0;;a++){for(var s=t[a],c=s?i?s.origFrom:s.editFrom:1e9;n<r.alignable.length;n+=2){var h=r.alignable[n]+1;if(!(h<=o)){if(!(h<=c))break;l.push(h)}}if(!s)break;l.push(o=i?s.origTo:s.editTo)}return l}function T(e,t,i,r){var o=0,n=0,l=0,a=0;e:for(;;o++){var s=e[o],c=t[n];if(!s&&null==c)break;for(var h=s?s[0]:1e9,g=null==c?1e9:c;l<i.length;){var f=i[l];if(f.origFrom<=g&&f.origTo>g){n++,o--;continue e}if(h<f.editTo){if(f.editFrom<=h)continue e;break}a+=f.origTo-f.origFrom-(f.editTo-f.editFrom),l++}h==g-a?(s[r]=g,n++):h<g-a?s[r]=h+a:((c=[g-a,null,null])[r]=g,e.splice(o,0,c),n++)}}function F(e,t){if(e.dealigned||t){if(!e.orig.curOp)return e.orig.operation(function(){F(e,t)});e.dealigned=!1;for(var i=e.mv.left==e?e.mv.right:e.mv.left,r=(i&&(h(i),i.dealigned=!1),((e,t)=>{var i=S(e.edit,e.chunks,!1),r=[];if(t)for(var o=0,n=0;o<t.chunks.length;o++){for(var l=t.chunks[o].editTo;n<i.length&&i[n]<l;)n++;n!=i.length&&i[n]==l||i.splice(n++,0,l)}for(o=0;o<i.length;o++)r.push([i[o],null,null]);return T(r,S(e.orig,e.chunks,!0),e.chunks,1),t&&T(r,S(t.orig,t.chunks,!0),t.chunks,2),r})(e,i)),o=e.mv.aligners,n=0;n<o.length;n++)o[n].clear();o.length=0;var l=[e.edit,e.orig],a=[],s=[];i&&l.push(i.orig);for(n=0;n<l.length;n++)a.push(l[n].getScrollInfo().top),s.push(-l[n].getScrollerElement().getBoundingClientRect().top);(s[0]!=s[1]||3==l.length&&s[1]!=s[2])&&M(l,s,[0,0,0],o);for(var c=0;c<r.length;c++)M(l,s,r[c],o);for(n=0;n<l.length;n++)l[n].scrollTo(null,a[n])}}function M(e,t,i,r){for(var o,n=-1e8,l=[],a=0;a<e.length;a++)null!=i[a]&&(o=e[a].heightAtLine(i[a],"local")-t[a],l[a]=o,n=Math.max(n,o));for(var s,c,h,g,f,a=0;a<e.length;a++)null!=i[a]&&1<(h=n-l[a])&&r.push((s=e[a],c=i[a],h=h,g=!(f=g=void 0),c>s.lastLine()&&(c--,g=!1),(f=document.createElement("div")).className="CodeMirror-merge-spacer",f.style.height=h+"px",f.style.minWidth="1px",s.addLineWidget(c,f,{height:h,above:g,mergeSpacer:!0,handleMouseEvents:!0})))}function n(e,t,i,r){var o,n,l,a;e.diffOutOfDate||(o=r.origTo>i.lastLine()?w(r.origFrom-1):w(r.origFrom,0),n=w(r.origTo,0),l=r.editTo>t.lastLine()?w(r.editFrom-1):w(r.editFrom,0),r=w(r.editTo,0),(a=e.mv.options.revertChunk)?a(e.mv,i,o,n,t,l,r):t.replaceRange(i.getRange(o,n),l,r))}var a,L=p.MergeView=function(e,g){if(!(this instanceof L))return new L(e,g);function t(){h&&k(h),f&&k(f)}var i,r,o=(this.options=g).origLeft,n=null==g.origRight?g.orig:g.origRight,l=null!=o,a=null!=n,s=1+(l?1:0)+(a?1:0),c=[],h=this.left=null,f=this.right=null,d=this,l=(l&&(h=this.left=new v(this,"left"),i=B("div",null,"CodeMirror-merge-pane CodeMirror-merge-left"),c.push(i),c.push(A(h))),B("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor")),u=(c.push(l),a&&(f=this.right=new v(this,"right"),c.push(A(f)),r=B("div",null,"CodeMirror-merge-pane CodeMirror-merge-right"),c.push(r)),(a?r:l).className+=" CodeMirror-merge-pane-rightmost",c.push(B("div",null,null,"height: 0; clear: both;")),this.wrap=e.appendChild(B("div",c,"CodeMirror-merge CodeMirror-merge-"+s+"pane"))),m=(this.edit=p(l,I(g)),h&&h.init(i,o,g),f&&f.init(r,n,g),g.collapseIdentical&&this.editor().operation(function(){var e=d,t=g.collapseIdentical;"number"!=typeof t&&(t=2);for(var i=[],r=e.editor(),o=r.firstLine(),n=o,l=r.lastLine();n<=l;n++)i.push(!0);e.left&&O(e.left,t,o,i),e.right&&O(e.right,t,o,i);for(var a=0;a<i.length;a++)if(i[a]){for(var s,c=a+o,h=1;a<i.length-1&&i[a+1];a++,h++);t<h&&(s=[{line:c,cm:r}],e.left&&s.push({line:b(c,e.left.chunks),cm:e.left.orig}),e.right&&s.push({line:b(c,e.right.chunks),cm:e.right.orig}),s=((e,t)=>{var i=[];function r(){for(var e=0;e<i.length;e++)i[e].clear()}for(var o=0;o<t.length;o++){var n=t[o],n=((e,t,i)=>{e.addLineClass(t,"wrap","CodeMirror-merge-collapsed-line");var r=document.createElement("span"),o=(r.className="CodeMirror-merge-collapsed-widget",r.title=e.phrase("Identical text collapsed. Click to expand."),e.markText(w(t,0),w(i-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:r,clearOnEnter:!0}));function n(){o.clear(),e.removeLineClass(t,"wrap","CodeMirror-merge-collapsed-line")}return o.explicitlyCleared&&n(),p.on(r,"click",n),o.on("clear",n),p.on(r,"click",n),{mark:o,clear:n}})(n.cm,n.line,n.line+e);i.push(n),n.mark.on("clear",r)}return i[0].mark})(h,s),e.options.onCollapse)&&e.options.onCollapse(e,c,h,s)}}),"align"==g.connect&&(this.aligners=[],F(this.left||this.right,!0)),h&&h.registerEvents(f),f&&f.registerEvents(h),p.on(window,"resize",t),setInterval(function(){for(var e=u.parentNode;e&&e!=document.body;e=e.parentNode);e||(clearInterval(m),p.off(window,"resize",t))},5e3))};function A(t){var i,e=t.lockButton=B("div",null,"CodeMirror-merge-scrolllock"),r=(e.setAttribute("role","button"),e.setAttribute("tabindex","0"),B("div",[e],"CodeMirror-merge-scrolllock-wrap")),e=(p.on(e,"click",function(){o(t,!t.lockScroll)}),p.on(e,"keyup",function(e){"Enter"!==e.key&&"Space"!==e.code||o(t,!t.lockScroll)}),[r]);return!1!==t.mv.options.revertButtons&&(t.copyButtons=B("div",null,"CodeMirror-merge-copybuttons-"+t.type),p.on(t.copyButtons,"click",i=function(e){e=e.target||e.srcElement;e.chunk&&("CodeMirror-merge-copy-reverse"==e.className?n(t,t.orig,t.edit,e.chunk):n(t,t.edit,t.orig,e.chunk))}),p.on(t.copyButtons,"keyup",function(e){"Enter"!==e.key&&"Space"!==e.code||i(e)}),e.unshift(t.copyButtons)),"align"!=t.mv.options.connect&&((r=document.createElementNS&&document.createElementNS(C,"svg"))&&!r.createSVGRect&&(r=null),t.svg=r)&&e.push(r),t.gap=B("div",e,"CodeMirror-merge-gap")}function r(e){return"string"==typeof e?e:e.getValue()}function s(e,t,i){for(var r=(a=a||new diff_match_patch).diff_main(e,t),o=0;o<r.length;++o){var n=r[o];(i?/[^ \t]/.test(n[1]):n[1])?o&&r[o-1][0]==n[0]&&(r.splice(o--,1),r[o][1]+=n[1]):r.splice(o--,1)}return r}function c(e){var t=[];if(e.length){for(var i=0,r=0,o=w(0,0),n=w(0,0),l=0;l<e.length;++l){var a,s,c,h,g=e[l],f=g[0];f==DIFF_EQUAL?(s=!E(e,l)||o.line<i||n.line<r?1:0,a=o.line+s,s=n.line+s,N(o,g[1],null,n),h=D(e,l)?1:0,c=o.line+h,h=n.line+h,a<c&&(l&&t.push({origFrom:r,origTo:s,editFrom:i,editTo:a}),i=c,r=h)):N(f==DIFF_INSERT?o:n,g[1])}(i<=o.line||r<=n.line)&&t.push({origFrom:r,origTo:n.line+1,editFrom:i,editTo:o.line+1})}return t}function D(e,t){var i;return t==e.length-1||!(1==(i=e[t+1][1]).length&&t<e.length-2||10!=i.charCodeAt(0))&&(t==e.length-2||(1<(i=e[t+2][1]).length||t==e.length-3)&&10==i.charCodeAt(0))}function E(e,t){var i;return 0==t||10==(i=e[t-1][1]).charCodeAt(i.length-1)&&(1==t||10==(i=e[t-2][1]).charCodeAt(i.length-1))}function O(e,t,i,r){for(var o=0;o<e.chunks.length;o++)for(var n=e.chunks[o],l=n.editFrom-t;l<n.editTo+t;l++){var a=l+i;0<=a&&a<r.length&&(r[a]=!1)}}function B(e,t,i,r){var o=document.createElement(e);if(i&&(o.className=i),r&&(o.style.cssText=r),"string"==typeof t)o.appendChild(document.createTextNode(t));else if(t)for(var n=0;n<t.length;++n)o.appendChild(t[n]);return o}function x(e){for(var t=e.childNodes.length;0<t;--t)e.removeChild(e.firstChild)}function _(e){for(var t=1;t<arguments.length;t+=2)e.setAttribute(arguments[t],arguments[t+1])}function I(e,t){for(var i in t=t||{},e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function N(e,t,i,r){for(var o=i?w(e.line,e.ch):e,n=0;;){var l=t.indexOf("\n",n);if(-1==l)break;++o.line,r&&++r.line,n=l+1}return o.ch=(n?0:o.ch)+(t.length-n),r&&(r.ch=(n?0:r.ch)+(t.length-n)),o}L.prototype={constructor:L,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(e){this.right&&this.right.setShowDifferences(e),this.left&&this.left.setShowDifferences(e)},rightChunks:function(){if(this.right)return h(this.right),this.right.chunks},leftChunks:function(){if(this.left)return h(this.left),this.left.chunks}};var H=1,R=2,W=4;function V(e){this.cm=e,this.alignable=[],this.height=e.doc.height;var l=this;e.on("markerAdded",function(e,t){t.collapsed&&null!=(t=t.find(1))&&l.set(t.line,W)}),e.on("markerCleared",function(e,t,i,r){null!=r&&t.collapsed&&l.check(r,W,l.hasMarker)}),e.on("markerChanged",this.signal.bind(this)),e.on("lineWidgetAdded",function(e,t,i){t.mergeSpacer||(t.above?l.set(i-1,R):l.set(i,H))}),e.on("lineWidgetCleared",function(e,t,i){t.mergeSpacer||(t.above?l.check(i-1,R,l.hasWidgetBelow):l.check(i,H,l.hasWidget))}),e.on("lineWidgetChanged",this.signal.bind(this)),e.on("change",function(e,t){var i=t.from.line,r=t.to.line-t.from.line,o=t.text.length-1,n=i+o;(r||o)&&l.map(i,r,o),l.check(n,W,l.hasMarker),(r||o)&&l.check(t.from.line,W,l.hasMarker)}),e.on("viewportChange",function(){l.cm.doc.height!=l.height&&l.signal()})}function t(e,t){var i=null,r=e.state.diffViews,o=e.getCursor().line;if(r)for(var n=0;n<r.length;n++){var l=r[n],a=e==l.orig,l=(h(l),(t<0?(e,t,i)=>{for(var r=e.length-1;0<=r;r--){var o=e[r],o=(i?o.origTo:o.editTo)-1;if(o<t)return o}}:(e,t,i)=>{for(var r=0;r<e.length;r++){var o=e[r],o=i?o.origFrom:o.editFrom;if(t<o)return o}})(l.chunks,o,a));null==l||null!=i&&!(t<0?i<l:l<i)||(i=l)}if(null==i)return p.Pass;e.setCursor(i,0)}V.prototype={signal:function(){p.signal(this,"realign"),this.height=this.cm.doc.height},set:function(e,t){for(var i=-1;i<this.alignable.length;i+=2){var r=this.alignable[i]-e;if(0==r)return(this.alignable[i+1]&t)==t?void 0:(this.alignable[i+1]|=t,void this.signal());if(0<r)break}this.signal(),this.alignable.splice(i,0,e,t)},find:function(e){for(var t=0;t<this.alignable.length;t+=2)if(this.alignable[t]==e)return t;return-1},check:function(e,t,i){var r=this.find(e);-1!=r&&this.alignable[r+1]&t&&(i.call(this,e)||(this.signal(),(i=this.alignable[r+1]&~t)?this.alignable[r+1]=i:this.alignable.splice(r,2)))},hasMarker:function(e){var t=this.cm.getLineHandle(e);if(t.markedSpans)for(var i=0;i<t.markedSpans.length;i++)if(t.markedSpans[i].marker.collapsed&&null!=t.markedSpans[i].to)return!0;return!1},hasWidget:function(e){var t=this.cm.getLineHandle(e);if(t.widgets)for(var i=0;i<t.widgets.length;i++)if(!t.widgets[i].above&&!t.widgets[i].mergeSpacer)return!0;return!1},hasWidgetBelow:function(e){if(e!=this.cm.lastLine()){var t=this.cm.getLineHandle(e+1);if(t.widgets)for(var i=0;i<t.widgets.length;i++)if(t.widgets[i].above&&!t.widgets[i].mergeSpacer)return!0}return!1},map:function(e,t,i){for(var r=i-t,o=e+t,n=-1,l=-1,a=0;a<this.alignable.length;a+=2){var s=this.alignable[a];s==e&&this.alignable[a+1]&R&&(n=a),s==o&&this.alignable[a+1]&R&&(l=a),s<=e||(s<o?this.alignable.splice(a--,2):this.alignable[a]+=r)}-1<n&&((t=this.alignable[n+1])==R?this.alignable.splice(n,2):this.alignable[n+1]=t&~R),-1<l&&i&&this.set(e+i,R)}},p.commands.goNextDiff=function(e){return t(e,1)},p.commands.goPrevDiff=function(e){return t(e,-1)}});